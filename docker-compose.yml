services:
  code-indexer-mcp:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        FASTMCP_PORT: ${FASTMCP_PORT}
    ports:
      - "${FASTMCP_PORT}:${FASTMCP_PORT}"
    volumes:
      - ./chroma_db:/app/chroma_db  # Persist ChromaDB data
      - ${PROJECTS_ROOT}:/projects:ro   # Mount projects root directory as read-only with no symlink resolution
      - ./container_cache:/root/.cache  # Mount a cache folder into the container
    environment:
      FASTMCP_PORT: ${FASTMCP_PORT} # Use env variable for FastMCP port
      PROJECTS_ROOT: /projects
      FOLDERS_TO_INDEX: ${FOLDERS_TO_INDEX}  # Use env variable for folders
      ADDITIONAL_IGNORE_DIRS: ${ADDITIONAL_IGNORE_DIRS}  # Additional directories to ignore
      ADDITIONAL_IGNORE_FILES: ${ADDITIONAL_IGNORE_FILES}  # Additional files to ignore
      DEBOUNCE_SECONDS: ${DEBOUNCE_SECONDS:-10.0}  # Debounce time for file change processing
    restart: unless-stopped
    container_name: code-indexer-mcp 